---
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);


const products = [
  {
    title: t("productHighlight.title"),
    image: "/img/products/300-bio-1.png",
    description: t("productHighlight.descriptionFront"),
  },
  {
    title: t("productHighlight.title"),
    image: "/img/products/300-bio-2.png",
    description: t("productHighlight.descriptionFront"),
  },
];
---

<section
  class="flex flex-col items-center justify-center bg-[#FFFFFF] p-6 md:p-5 w-9/10 md:w-2/2 mx-auto text-center shadow-lg relative overflow-hidden"
>
  <div class="relative w-full flex items-center justify-center">
    <img
      id="productImage"
      src={products[0].image}
      alt="Coffee product"
      class="max-h-[500px] object-contain mx-auto rounded-lg transition-opacity duration-700 opacity-100"
    />
  </div>

  <div
    class="mt-6 border border-gray-300 text-black font-semibold text-lg md:text-xl px-6 py-2 rounded-full"
  >
    16,99 €
  </div>

  <p
    id="productDesc"
    class="mt-6 text-lg md:text-xl text-primary font-medium leading-tight"
    set:html={products[0].description}
  ></p>

<button
    id="addToCart"
    class="bg-black text-white px-3 py-2 rounded-xl mt-2 hover:bg-[#5C3F32] transition"
    data-product-id="cafe-torrefies-bio"
    data-product-name="Grains de Café Torréfiés Bio"
    data-product-price="16.99"
    data-product-image="/img/products/300-bio-1.png"
>
    {t("product.addtocart")}
</button>

</section>

<script is:inline>
  window.addEventListener("DOMContentLoaded", () => {
    //  Get elements
    const addToCartBtn = document.getElementById("addToCart");
    const img = document.getElementById("productImage");
    const desc = document.getElementById("productDesc");

    //  Define product data (you can tweak these if you want dynamic)
    const product = {
      id: "highlight-coffee", 
      name: "Café Bio Amazonas",
      price: 16.99,
      image: "/img/products/300-bio-1.png",
      format: "250g",
      quantity: 1,
    };

    //  Add to Cart
const btn = document.getElementById("addToCart");

btn?.addEventListener("click", () => {
    const product = {
        id: btn.dataset.productId,
        name: btn.dataset.productName,
        price: parseFloat(btn.dataset.productPrice),
        image: btn.dataset.productImage,
        quantity: 1,
        format: "250g",
    };

    window.addToCart(product);
    window.dispatchAddToCartModal(product);
});




    //  Slideshow logic
    const products = [
      {
        image: "/img/products/300-bio-1.png",
        description: `GRAINS DE CAFÉ TORRÉFIÉS PURS<br /><strong>ARABIQUE DE FORÊT D'ALTITUDE<br />100% BIO</strong>`,
      },
      {
        image: "/img/products/300-bio-2.png",
        description: `GRAINS DE CAFÉ TORRÉFIÉS PURS<br /><strong>ARABIQUE DE FORÊT D'ALTITUDE<br />100% BIO</strong>`,
      },
    ];

    if (!img || !desc) return;

    let current = 0;
    function updateSlide(index) {
      img.style.transition = "opacity 0.7s ease-in-out";
      img.style.opacity = "0";
      setTimeout(() => {
        img.src = products[index].image;
        desc.innerHTML = products[index].description;
        img.style.opacity = "1";
      }, 300);
    }

    function nextSlide() {
      current = (current + 1) % products.length;
      updateSlide(current);
    }

    let autoSlide = setInterval(nextSlide, 5000);

    const section = document.querySelector("section");
    if (section) {
      section.addEventListener("mouseenter", () => clearInterval(autoSlide));
      section.addEventListener("mouseleave", () => {
        autoSlide = setInterval(nextSlide, 5000);
      });
    }
  });
</script>


