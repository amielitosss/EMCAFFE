---
import Layout from '@/layouts/Layout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import countries from '@/data/countries.json';
import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import SendcloudPickupPoints from '@/components/SendcloudPickupPoints.astro';

export function getStaticPaths() {
	const languages = ['fr', 'en', 'es'];
	return languages.map((lang) => ({
		params: { lang },
	}));
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<Layout title="Destination">
	<Header />

	<!-- Banner -->
	<section
		class="relative z-0 h-[250px] w-full overflow-hidden md:h-[350px]"
		style="margin-top: 160px;"
	>
		<img
			src="/img/grains.webp"
			alt="Coffee beans background"
			class="absolute inset-0 h-full w-full object-cover object-[center_40%]"
		/>
		<div
			class="absolute inset-0 flex items-center justify-center bg-black/40"
		>
			<h1
				class="font-[Chalkduster] text-4xl tracking-widest text-white md:text-6xl"
			>
				DESTINATION
			</h1>
		</div>
	</section>

	<!-- Main -->
	<main
		class="flex flex-col items-center justify-center bg-[#FEFBED] px-6 py-12 md:px-12"
	>
		<div
			class="flex w-full flex-col items-start gap-8 md:w-3/4 md:flex-row lg:w-4/5"
		>
			<!-- LEFT: Steps -->
			<section
				class="w-full space-y-8 rounded-md border border-[#5C3F32] bg-[#FEFBED] p-8 md:flex-1"
			>
				<!-- STEP ONE -->
				<div id="stepOne" class="space-y-6">
					<h2
						class="border-b pb-2 text-xl font-semibold text-[#5C3F32]"
					>
						{t('destination.personalInfo')}
					</h2>

					<form class="space-y-4">
						<div>
							<label
								class="mb-1 block font-semibold text-[#5C3F32]"
							>
								{t('destination.email')} *
							</label>
							<input
								id="emailInput"
								type="email"
								class="w-full border border-[#5C3F32] p-2"
								placeholder="abcd@gmail.com"
								required
							/>
						</div>

						<div>
							<label
								class="mb-1 block font-semibold text-[#5C3F32]"
							>
								{t('destination.password')} *
							</label>
							<input
								id="passwordInput"
								type="password"
								class="w-full border border-[#5C3F32] p-2"
								placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
								required
							/>
						</div>

						<div>
							<a
								href={`/${lang}/forgot-password`}
								class="mt-2 flex justify-center text-sm text-[#A47343] hover:underline"
							>
								{t('destination.forgotPassword')}
							</a>
						</div>

						<div class="flex justify-center">
							<button
								id="toStep2"
								type="button"
								class="rounded-md bg-black px-6 py-2 text-white transition hover:bg-[#5C3F32]"
							>
								{t('destination.continue')}
							</button>
						</div>
					</form>
				</div>

				<!-- STEP TWO -->
				<div id="stepTwo" class="hidden space-y-6">
					<h2
						class="border-b pb-2 text-xl font-semibold text-[#5C3F32]"
					>
						{t('destination.addresses')}
					</h2>

					<form class="space-y-4">
						<div class="grid grid-cols-1 gap-4 md:grid-cols-2">
							<div>
								<label
									class="mb-1 block font-semibold text-[#5C3F32]"
								>
									{t('destination.firstName')} *
								</label>
								<input
									type="text"
									class="w-full rounded-md border border-[#5C3F32] p-2"
									required
								/>
							</div>
							<div>
								<label
									class="mb-1 block font-semibold text-[#5C3F32]"
								>
									{t('destination.lastName')} *
								</label>
								<input
									type="text"
									class="w-full rounded-md border border-[#5C3F32] p-2"
									required
								/>
							</div>
						</div>

						<div>
							<label
								class="mb-1 block font-semibold text-[#5C3F32]"
							>
								{t('destination.addressComplement')} *
							</label>
							<input
								id="deliveryAddress"
								type="text"
								class="w-full rounded-md border border-[#5C3F32] p-2"
								placeholder="12 Rue du March√©, Appartement B"
								required
							/>
						</div>

						<div>
							<label
								class="mb-1 block font-semibold text-[#5C3F32]"
							>
								{t('destination.phone')} *
							</label>
							<input
								id="deliveryPhone"
								type="text"
								class="w-full rounded-md border border-[#5C3F32] p-2"
								placeholder="+33 6 12 34 56 78"
								required
							/>
						</div>

						<div>
							<label
								class="mb-1 block font-semibold text-[#5C3F32]"
							>
								{t('destination.postalCode')} *
							</label>
							<input
								id="deliveryPostal"
								type="text"
								class="w-full rounded-md border border-[#5C3F32] p-2"
								required
							/>
						</div>

						<div>
							<label
								class="mb-1 block font-semibold text-[#5C3F32]"
							>
								{t('destination.city')} *
							</label>
							<input
								id="deliveryCity"
								type="text"
								class="w-full rounded-md border border-[#5C3F32] p-2"
								required
							/>
						</div>

						<div>
							<label
								class="mb-1 block font-semibold text-[#5C3F32]"
							>
								{t('destination.country')} *
							</label>
							<select
								class="w-full rounded-md border border-[#5C3F32] p-2"
								id="deliveryCountry"
								required
							>
								{
									countries.map((c) => (
										<option value={c}>{c}</option>
									))
								}
							</select>
						</div>

						<div class="flex justify-between gap-2">
							<button
								id="backToStep1"
								type="button"
								class="rounded-md border border-[#5C3F32] px-6 py-2 text-[#5C3F32] transition hover:bg-[#f9f4ee]"
							>
								‚Üê {t('destination.previous')}
							</button>
							<button
								id="toStep3"
								type="button"
								class="rounded-md bg-black px-6 py-2 text-white transition hover:bg-[#5C3F32]"
							>
								{t('destination.continue')}
							</button>
						</div>
					</form>
				</div>

				<!-- STEP THREE -->
				<div id="stepThree" class="hidden space-y-6">
					<SendcloudPickupPoints />
						
				</div>

				<!-- STEP FOUR -->
				<div id="stepFour" class="hidden space-y-6">
					<h2
						class="border-b pb-2 text-xl font-semibold text-[#5C3F32]"
					>
						{t('destination.payment')}
					</h2>

					<form class="space-y-6">
						<!-- BANK TRANSFER -->
						<label
							class="payment-option flex cursor-pointer items-center justify-between rounded-md border border-[#A47343] p-4 transition hover:bg-[#f9f4ee]"
						>
							<div class="flex items-center gap-3">
								<input
									type="radio"
									name="payment"
									value="bank_transfer"
								/>
								<span>{t('destination.payWithVirement')}</span>
							</div>
							<div class="text-xs text-[#A47343]">
								{t('destination.virement')}
							</div>
							<img
								src="/img/virement.png"
								class="h-[40px] w-[100px] object-contain opacity-80"
								alt="Virement bancaire"
							/>
						</label>

						<div
							id="bankInfoSection"
							class="mt-3 hidden rounded-md border border-[#A47343] bg-[#faf5ef] p-4"
						>
							<p class="mb-3 text-sm">
								{t('destination.bankTransferInfo')}
							</p>
							<div class="space-y-1 text-sm">
								<p>
									<strong>IBAN:</strong> FR76 3000 4000 1234 5678
									9012 345
								</p>
								<p><strong>BIC:</strong> BNPAFRPP</p>
								<p><strong>Bank:</strong> BNP Paribas</p>
								<p>
									<strong
										>{t('destination.reference')}:</strong
									>
									<span id="bankReference">ORDER-XXXXXX</span>
								</p>
							</div>
						</div>

						<!-- CONFIRMATION -->
						<div
							id="bankConfirmation"
							class="mt-4 hidden rounded-md bg-[#5C3F32] p-4 text-white"
						>
							<h3 class="text-lg font-semibold">
								{t('destination.bankTransferConfirmed')}
							</h3>
							<p class="mb-2 text-sm">
								<strong
									>{
										t(
											'destination.bankTransferInstructions',
										)
									}:</strong
								>
								<span id="bankReferenceTwo"></span>
							</p>
							<p class="text-sm">
								<strong>{t('destination.amount')}:</strong>
								<span id="bankAmount"></span> ‚Ç¨
							</p>
						</div>

						<!-- CARD -->
						<label
							class="flex cursor-pointer items-center justify-between rounded-md border border-[#A47343] p-4 hover:bg-[#f9f4ee]"
						>
							<div class="flex items-center gap-3">
								<input
									type="radio"
									name="payment"
									value="card"
								/>
								<span>{t('destination.payWithCard')}</span>
							</div>
							<div class="flex gap-3">
								<img
									src="/img/visa.webp"
									class="w-[40px]"
									alt="Visa"
								/>
								<img
									src="/img/mastercard.png"
									class="w-[40px]"
									alt="Mastercard"
								/>
								<img
									src="/img/cb.webp"
									class="w-[40px]"
									alt="CB"
								/>
							</div>
						</label>

						<!-- CARD FORM SECTION WITH BLUE UI -->
						<div
							id="cardFormSection"
							class="mt-4 hidden max-w-md space-y-4"
						>
							<!-- Blue Card Preview -->
							<div
								class="max-w-sm rounded-xl bg-gradient-to-br from-[#003366] to-[#0055AA] p-4 text-white shadow-md md:p-6"
							>
								<div
									class="mb-4 flex items-center justify-between"
								>
									<span
										class="text-xs uppercase tracking-wide opacity-80"
									>
										EMCAFF√â
									</span>
									<div
										class="h-7 w-10 rounded-md bg-white/30"
									>
									</div>
								</div>

								<div
									id="cardNumberDisplay"
									class="mb-4 font-mono text-lg tracking-[0.2em] md:text-xl"
								>
									‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢
								</div>

								<div
									class="flex justify-between text-xs md:text-sm"
								>
									<div>
										<p class="opacity-70">NOM</p>
										<p
											id="cardNameDisplay"
											class="font-semibold"
										>
											NOM PR√âNOM
										</p>
									</div>
									<div>
										<p class="opacity-70">EXP</p>
										<p
											id="cardExpiryDisplay"
											class="font-semibold"
										>
											MM/AA
										</p>
									</div>
									<div>
										<p class="opacity-70">CVC</p>
										<p
											id="cardCvcDisplay"
											class="font-semibold"
										>
											‚Ä¢‚Ä¢‚Ä¢
										</p>
									</div>
								</div>
							</div>

							<!-- Stripe Card Element -->
							<div class="max-w-md space-y-3">
								<label
									class="mb-1 block text-sm font-medium text-[#5C3F32]"
								>
									{t('destination.cardNumber')}
								</label>
								<div
									id="card-element"
									class="w-full rounded-md border border-[#5C3F32] bg-white p-3"
								>
								</div>
								<p
									id="card-errors"
									class="mt-1 text-xs text-red-600"
								>
								</p>
							</div>
						</div>

						<!-- BUTTONS -->
						<div class="flex justify-between gap-2">
							<button
								id="backToStep3"
								type="button"
								class="rounded-md border border-[#5C3F32] px-6 py-2 text-[#5C3F32]"
							>
								‚Üê {t('destination.previous')}
							</button>
							<button
								id="placeOrder"
								type="button"
								class="rounded-md bg-black px-6 py-2 text-white hover:bg-[#5C3F32]"
							>
								{t('destination.order')}
							</button>
						</div>
					</form>
				</div>
			</section>

			<!-- SUMMARY CARD -->
			<aside
				id="summaryCard"
				class="h-fit w-full rounded-lg border border-[#5C3F32] bg-[#FEFBED] p-6 text-[#5C3F32] shadow-md md:w-[40%]"
			>
				<h3 class="mb-4 text-center text-lg font-semibold">
					üõí Your Order
				</h3>
				<div id="summaryItems" class="mb-4 space-y-4"></div>

				<div
					class="w-full space-y-2 border-t border-[#A47343]/40 pt-2 text-sm"
				>
					<div class="flex justify-between">
						<span>Delivery:</span>
						<span id="summaryDelivery">0.00‚Ç¨</span>
					</div>
					<hr class="my-1 border-[#5C3F32]/40" />
					<div class="flex justify-between text-lg font-semibold">
						<span>TTC:</span>
						<span id="summaryTotal">0.00‚Ç¨</span>
					</div>
				</div>
			</aside>
		</div>
	</main>

	<Footer />
</Layout>

<!-- Scripts -->
<script src="../../../public/scripts/checkoutstep3.ts"></script>
<script src="https://js.stripe.com/v3/"></script>
<script src="/scripts/destination.js" defer></script>

<style>
	.delivery-option input[type='radio']:checked {
		accent-color: #5c3f32;
	}

	.delivery-option:has(input:checked) {
		border-color: #5c3f32;
		background-color: #f9f4ee;
	}

	#Zone_Widget {
		border: 1px solid #e5e7eb;
		border-radius: 8px;
		padding: 15px;
		background: white;
	}

	.search-bar input:focus {
		outline: none;
		border-color: #e2001a;
		box-shadow: 0 0 0 3px rgba(226, 0, 26, 0.1);
	}

	#relay-selected p {
		margin: 3px 0;
	}
</style>
